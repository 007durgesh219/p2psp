
                  .-----------------#-----------------#-----------------#-----------------.
                  |[  Monitor peer ]|[    Splitter   ]|[     Peer 1    ]|[     Peer 2    ]| 
                  +-----------------+-----------------+-----------------+-----------------+ 
.---------------. |                 |                 |                 |                 | 
| Initial state | |       connection| established     |                 |                 | 
'---------------' |         <-------+-------> <-------+------->         |                 | 
                  |                 |                 |                 |                 | 
                  |                 |       connection| established     |                 | 
                  |         <-------+-----------------+------->         +                 | 
                  |                 |                 |                 |                 | 
                  +=================+=================+=================+=================+ 
.---------------. |                 |                 |                 |                 | 
| Peer 2 arrives| |                 |                 |   hello (TCP)   |                 | 
'---------------' |                 |         <-------+-----------------+--------         | 
                  |                 |                 |                 |                 | 
                  |                 |             list| of peers (TCP)  |                 | 
                  |                 |         --------+-----------------+------->         | 
                  |                 |                 |                 |                 | 
                  |                 |                 | hello           |                 | 
                  |         <-------+-----------------+-----------------+--------         | 
                  |         --------+-----------------+-----------------+------->         | 
                  |                 |                 |                 |                 | 
                  |        forwarded| hello+port      |      hello      |                 | 
                  |         --------+-------> <-------+-----------------+--------         | 
                  |         <-------+-------- --------+-----------------+------->         | 
                  |                 |                 |                 |                 | 
                  |                 |         new peer| endpoint        |                 | 
                  |                 |         --------+------->         |                 | 
                  |                 |         --------+------->         |                 | 
                  |                 |                 |            hello|                 | 
                  |                 |                 |         --------+------->         | 
                  |                 |                 |         <-------+--------         | 
                  |                 |                 |                 |                 | 
                  |                 |           source| port of peer 1  |                 | 
                  |                 |         <-------+-----------------+--------         | 
                  |                 |         --------+-----------------+------->         | 
                  |                 |                 |                 |                 | 
                  |                 |                 |            hello|                 | 
                  |                 |                 |         <-------+--------         | 
                  |                 |                 |         --------+------->         | 
                  |                 |                 |                 |                 | 
                  |                 |      source port| of peer 2       |                 | 
                  |                 |         <-------+------           |                 | 
                  |                 |         --------+----->           |                 | 
                  |                 |                 |                 |                 | 
                  |                 |                 | success message |                 | 
                  |                 |         <-------+-----------------+--------         | 
                  |                 |         --------+-----------------+------->         | 
.---------------. |                 |                 |                 |                 | 
| Incorporation | |                 |  splitter closes|                 |  peer closes    | 
| successful    | |                 |  TCP socket     |                 |  TCP socket     | 
'---------------' '-----------------#-----------------#-----------------#-----------------' 

[  Monitor peer ]: {"fill":"#f0f0f0"}
[    Splitter   ]: {"fill":"#fbfbfb"} 
[     Peer 1    ]: {"fill":"#f0f0f0"} 
[     Peer 2    ]: {"fill":"#fbfbfb"} 

